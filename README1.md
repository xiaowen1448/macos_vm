# MacOS VM 虚拟机管理平台

## 项目概述

MacOS VM 虚拟机管理平台是一个基于 Flask 的 Web 应用程序，专门用于管理和控制 macOS 虚拟机。该平台提供了完整的虚拟机生命周期管理功能，包括虚拟机克隆、启动、停止、监控以及批量消息处理等功能。

## 核心功能

### 🖥️ 虚拟机管理
- **虚拟机克隆**: 支持从模板虚拟机批量克隆新的虚拟机实例
- **状态监控**: 实时监控虚拟机的运行状态、IP地址和SSH连通性
- **生命周期管理**: 启动、停止、重启虚拟机操作
- **网络配置**: 自动检测和配置虚拟机网络连接
- **缓存机制**: 智能缓存虚拟机状态信息，提高响应速度

### 📱 iMessage 批量处理
- **批量登录**: 支持批量 Apple ID 登录管理
- **消息发送**: 大规模消息发送功能
- **模板管理**: 消息模板的创建和管理
- **账号管理**: Apple ID 和手机号码的批量管理

### 🌐 Web 界面
- **仪表板**: 直观的虚拟机状态概览
- **虚拟机管理**: 完整的虚拟机操作界面
- **响应式设计**: 支持多种屏幕尺寸的现代化 UI
- **实时更新**: 基于 WebSocket 的实时状态更新

### 🖥️ 桌面应用
- **PyQt5 桌面客户端**: 提供原生桌面应用体验
- **内嵌浏览器**: 使用 QWebEngineView 展示 Web 界面
- **自动启动**: 自动启动 Flask 后端服务

## 技术架构

### 后端技术栈
- **Flask**: Web 框架核心
- **Flask-SocketIO**: WebSocket 实时通信
- **Paramiko**: SSH 连接和远程操作
- **Threading**: 多线程任务处理
- **Subprocess**: 系统命令执行

### 前端技术栈
- **Bootstrap 5**: UI 框架
- **Font Awesome**: 图标库
- **JavaScript**: 前端交互逻辑
- **WebSocket**: 实时数据通信

### 桌面应用
- **PyQt5**: 桌面应用框架
- **QWebEngineView**: 内嵌浏览器组件

## 项目结构

```
macos_vm/
├── app.py                    # Flask 主应用文件
├── webview_app.py           # PyQt5 桌面应用
├── config.py                # 全局配置文件
├── requirements.txt         # Python 依赖包
├── start.bat               # Web 版启动脚本
├── start_webview.bat       # 桌面版启动脚本
├── app/                    # 应用模块
│   └── routes/            # 路由模块
│       ├── mass_messaging.py  # 批量消息处理
│       └── batch_im_login.py   # 批量登录管理
├── web/                    # Web 资源
│   ├── templates/         # HTML 模板
│   │   ├── dashboard.html     # 仪表板页面
│   │   ├── vm_management.html # 虚拟机管理页面
│   │   └── base.html         # 基础模板
│   └── static/           # 静态资源
├── logs/                   # 日志文件目录
├── EFI/                   # EFI 引导文件
└── README.md              # 项目说明文档
```

## 核心特性

### 智能缓存系统
- **多层缓存**: 支持在线状态、五码信息、聚合信息等多种缓存类型
- **自动过期**: 智能的缓存过期机制
- **线程安全**: 使用锁机制确保缓存操作的线程安全

### 任务管理系统
- **异步任务**: 支持长时间运行的异步任务
- **进度跟踪**: 实时跟踪任务执行进度
- **状态管理**: 完整的任务状态生命周期管理

### 网络监控
- **Ping 检测**: 自动检测虚拟机网络连通性
- **SSH 验证**: 验证 SSH 服务可用性
- **超时控制**: 可配置的网络检测超时时间

## 配置管理

项目使用 `config.py` 进行集中配置管理，包括：
- 虚拟机路径配置
- 用户认证信息
- 网络端口设置
- 日志目录配置
- Apple ID 和手机号目录配置

## 启动方式

### Web 版本
```bash
# Windows
start.bat

# 或直接运行
python app.py
```

### 桌面版本
```bash
# Windows
start_webview.bat

# 或直接运行
python webview_app.py
```

## 依赖要求

主要 Python 依赖包：
- Flask >= 2.0.0
- Flask-SocketIO
- PyQt5
- paramiko
- requests
- 其他依赖详见 `requirements.txt`

## 日志系统

- **分日期日志**: 按日期自动分割日志文件
- **多级别日志**: 支持 DEBUG、INFO、WARNING、ERROR 等日志级别
- **双重输出**: 同时输出到文件和控制台
- **UTF-8 编码**: 支持中文日志内容

## 安全特性

- **Session 管理**: 安全的用户会话管理
- **权限控制**: 基于用户认证的访问控制
- **SSH 密钥**: 支持 SSH 密钥认证
- **自动清理**: 启动时自动清理过期 Session

## 扩展性

- **模块化设计**: 清晰的模块分离和蓝图注册
- **插件架构**: 支持功能模块的独立开发和集成
- **配置驱动**: 通过配置文件轻松调整系统行为
- **API 友好**: RESTful API 设计，便于第三方集成

---

该平台为 macOS 虚拟机的批量管理和自动化操作提供了完整的解决方案，特别适用于需要管理大量 macOS 虚拟机实例的场景。