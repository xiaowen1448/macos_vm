# 虚拟机批量克隆系统使用说明

## 快速开始

### 1. 启动系统

双击运行 `start.bat` 文件，或者在命令行中执行：

```bash
cd web
python app.py
```

### 2. 访问系统

打开浏览器访问：http://localhost:5000

- 用户名：admin
- 密码：123456

### 3. 使用克隆功能

1. 登录后点击左侧菜单的"虚拟机批量克隆"
2. 填写克隆参数
3. 点击"开始克隆"
4. 查看实时日志和进度

## 功能说明

### 克隆参数说明

- **模板虚拟机**：选择要克隆的模板虚拟机文件
- **克隆数量**：要克隆的虚拟机数量（1-20个）
- **目标目录**：克隆后的虚拟机存放目录
- **命名模式**：虚拟机命名规则（下拉选择或自定义）
  - `{timestamp}` 会被替换为时间戳
  - `{index}` 会被替换为序号
  - `{vmname}` 会被替换为虚拟机名称
- **配置文件目录**：选择包含plist文件的目录，系统会自动检查文件数量是否足够
- **自动启动**：是否在克隆完成后自动启动虚拟机
- **创建快照**：是否在克隆前为模板虚拟机创建快照备份，并从快照进行克隆
- **快照命名**：快照命名规则（下拉选择或自定义），支持 {vmname} 和 {timestamp} 占位符

### 克隆流程

1. **快照创建**：如果启用快照功能，系统会先为模板虚拟机创建快照
2. **快照验证**：验证快照是否创建成功
3. **从快照克隆**：使用创建的快照进行克隆操作
4. **克隆完成**：生成新的虚拟机文件

### 实时日志功能

- 日志会实时显示在页面底部
- 不同颜色代表不同级别：
  - 绿色：成功信息
  - 蓝色：一般信息
  - 黄色：警告信息
  - 红色：错误信息
- 可以清空日志或复制日志内容

### 进度显示

- 进度条显示当前克隆进度
- 统计信息显示成功/失败/运行中/总计数量
- 状态指示器显示当前任务状态

## 模拟模式

如果系统检测到VMware Workstation未安装或模板虚拟机不存在，会自动切换到模拟模式：

- 模拟克隆过程
- 创建模拟的虚拟机文件
- 显示完整的日志信息
- 可以测试所有功能

## 故障排除

### 常见问题

1. **无法启动系统**
   - 确保已安装Python 3.7+
   - 检查端口5000是否被占用

2. **克隆失败**
   - 检查VMware Workstation是否正确安装
   - 确保有足够的磁盘空间
   - 查看实时日志了解具体错误

3. **页面无法访问**
   - 确保系统已正常启动
   - 检查防火墙设置
   - 尝试使用 http://127.0.0.1:5000

### 测试系统

运行测试脚本验证系统功能：

```bash
python test_system.py
```

## 技术特性

- 基于Flask的Web应用
- 实时Server-Sent Events日志推送
- 多线程任务处理
- 响应式Web界面
- 支持真实和模拟两种模式
- 虚拟机快照功能
- 自定义快照命名规则

## 文件说明

- `app.py` - 主应用文件
- `clone_vm.html` - 克隆页面
- `start.bat` - Windows启动脚本
- `test_system.py` - 系统测试脚本
- `requirements.txt` - Python依赖
- `README.md` - 详细文档 