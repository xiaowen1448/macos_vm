<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>虚拟机控制面板</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 终端风格克隆日志窗口样式 -->
    <style>
    .clone-log-terminal {
      background: #181a1b;
      color: #e0e0e0;
      font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.18);
      margin-top: 24px;
      max-width: 100%;
      width: 100%;
      position: relative;
    }
    .clone-log-title {
      padding: 10px 18px;
      border-bottom: 1px solid #222;
      font-weight: bold;
      background: #23272b;
      color: #7fffd4;
      border-radius: 8px 8px 0 0;
      font-size: 1.08em;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .clone-log-copy {
      color: #7fffd4;
      background: none;
      border: none;
      font-size: 1.2em;
      cursor: pointer;
      margin-left: 8px;
      transition: color 0.18s;
    }
    .clone-log-copy:hover {
      color: #fff;
    }
    .clone-log-body {
      max-height: 240px;
      overflow-y: auto;
      padding: 14px 18px;
      font-size: 15px;
      line-height: 1.6;
      background: #181a1b;
    }
    .clone-log-body pre {
      margin: 0;
      color: #b6ffb6;
      background: none;
      font-family: inherit;
    }
    .btn, .btn:visited, .btn-outline-secondary, .btn-outline-secondary:visited {
      color: #222 !important;
      background: #fff !important;
      border: 2px solid #dee2e6 !important;
      border-radius: 24px !important;
            font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      transition: background 0.18s, color 0.18s, box-shadow 0.18s;
    }
    .btn:hover, .btn:focus,
    .btn-outline-secondary:hover, .btn-outline-secondary:focus {
      color: #222 !important;
      background: #f5f5f5 !important;
      border-color: #b0b3b8 !important;
      box-shadow: 0 4px 16px rgba(0,0,0,0.10);
        }
    </style>
</head>
<body>
<div class="d-flex align-items-center" style="position:absolute; top:18px; right:120px; z-index:2000;">
  <div class="dropdown">
    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="langDropdown" data-bs-toggle="dropdown" aria-expanded="false">
      语言
    </button>
    <ul class="dropdown-menu" aria-labelledby="langDropdown">
      <li><a class="dropdown-item" href="?lang=zh">中文</a></li>
      <li><a class="dropdown-item" href="?lang=en">English</a></li>
    </ul>
  </div>
</div>
<a href="{{ url_for('logout') }}" class="btn btn-outline-secondary position-absolute" style="top: 18px; right: 32px; z-index: 2000;">登出</a>
<div class="container-fluid mt-4">
    <div class="row">
        <!-- 左侧菜单 -->
        <nav class="col-md-3 col-lg-2 sidebar bg-white p-3">
            <h5 class="mb-4"><span style="color:#000; font-style:italic; font-weight:bold;">macos_vm</span></h5>
            <div class="accordion" id="accordionMenu">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingVM">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseVM" aria-expanded="false" aria-controls="collapseVM">
                            虚拟机管理
                        </button>
                    </h2>
                    <div id="collapseVM" class="accordion-collapse collapse" aria-labelledby="headingVM" data-bs-parent="#accordionMenu">
                        <div class="accordion-body p-0">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link" href="{{ url_for('clone_vm_page') }}" onclick="handleCloneClick()">虚拟机批量克隆</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleVMInfoClick()">虚拟机成品信息</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleVMScriptClick()">虚拟机脚本管理</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleVMTrustClick()">虚拟机互信管理</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingBoot">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBoot" aria-expanded="false" aria-controls="collapseBoot">
                            母盘及五码管理
                        </button>
                    </h2>
                    <div id="collapseBoot" class="accordion-collapse collapse" aria-labelledby="headingBoot" data-bs-parent="#accordionMenu">
                        <div class="accordion-body p-0">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleWumaClick()">虚拟机五码管理</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleMupanClick()">虚拟机母盘管理</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- 新增同级菜单项 -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingEncrypt">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEncrypt" aria-expanded="false" aria-controls="collapseEncrypt">
                            数据加密功能
                        </button>
                    </h2>
                    <div id="collapseEncrypt" class="accordion-collapse collapse" aria-labelledby="headingEncrypt" data-bs-parent="#accordionMenu">
                        <div class="accordion-body p-0">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleEncryptCodeClick()">代码加密</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleEncryptWumaClick()">五码加密</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleEncryptIdClick()">id加密</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingProxy">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProxy" aria-expanded="false" aria-controls="collapseProxy">
                            代理ip配置
                        </button>
                    </h2>
                    <div id="collapseProxy" class="accordion-collapse collapse" aria-labelledby="headingProxy" data-bs-parent="#accordionMenu">
                        <div class="accordion-body p-0">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleProxyAssignClick()">代理ip分配</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingSoft">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSoft" aria-expanded="false" aria-controls="collapseSoft">
                            虚拟机软件管理
                        </button>
                    </h2>
                    <div id="collapseSoft" class="accordion-collapse collapse" aria-labelledby="headingSoft" data-bs-parent="#accordionMenu">
                        <div class="accordion-body p-0">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleSoftVersionClick()">版本查看</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="handleSoftEnvClick()">环境变量</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingResource">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseResource" aria-expanded="false" aria-controls="collapseResource">
                            硬件资源管理
                        </button>
                    </h2>
                    <div id="collapseResource" class="accordion-collapse collapse" aria-labelledby="headingResource" data-bs-parent="#accordionMenu">
                        <div class="accordion-body p-0">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="showPanel('cpu')">CPU资源</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="showPanel('mem')">内存资源</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="showPanel('disk')">磁盘资源</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingSystem">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSystem" aria-expanded="false" aria-controls="collapseSystem">
                            系统管理
                        </button>
                    </h2>
                    <div id="collapseSystem" class="accordion-collapse collapse" aria-labelledby="headingSystem" data-bs-parent="#accordionMenu">
                        <div class="accordion-body p-0">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="showPanel('sys-version')">系统版本</a>
                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="showPanel('sys-plugin')">系统插件管理</a>
                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="showPanel('sys-user')">用户管理</a>
                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" onclick="showPanel('sys-auth')">授权管理</a>
                </li>
            </ul>
                        </div>
                    </div>
                </div>
 
            </div>
        </nav>
        <!-- 右侧内容 -->
        <main class="col-md-9 col-lg-10 p-4" id="detailPanel">
            <div id="panel-list">
                <h3>虚拟机成品信息</h3>
                <div class="mb-3 d-flex gap-2">
                    <button class="btn btn-outline-secondary btn-sm">批量重启</button>
                    <button class="btn btn-outline-secondary btn-sm">批量关机</button>
                    <button class="btn btn-outline-secondary btn-sm">批量挂起</button>
                    <button class="btn btn-outline-secondary btn-sm">批量更换五码</button>
                    <button class="btn btn-outline-secondary btn-sm">批量DeBug</button>
                </div>
                <table class="table table-bordered bg-white">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllVMs" onclick="toggleAllVMs(this)"></th>
                            <th>名称</th>
                            <th>IP地址</th>
                            <th>状态</th>
                            <th>Debug信息</th>
                            <th>更换五码</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for vm in vm_list %}
                        <tr>
                            <td><input type="checkbox" class="vm-checkbox"></td>
                            <td>{{ vm.name }}</td>
                            <td>{{ vm.ip }}</td>
                            <td>{{ vm.status }}</td>
                            <td><pre class="mb-0">{{ vm.imessage }}</pre></td>
                            <td><button class="btn btn-outline-secondary btn-sm px-2 py-1" style="font-size:12px;">手动分配五码</button></td>
                            <td>
                                <button class="btn btn-outline-secondary btn-sm px-2 py-1" style="font-size:12px;">挂起</button>
                                <button class="btn btn-outline-secondary btn-sm px-2 py-1" style="font-size:12px;">重启</button>
                                <button class="btn btn-outline-secondary btn-sm px-2 py-1" style="font-size:12px;">开机</button>
                                <button class="btn btn-outline-secondary btn-sm px-2 py-1" style="font-size:12px;">关机</button>
                                <button class="btn btn-outline-secondary btn-sm px-2 py-1" style="font-size:12px;">删除</button>

                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <nav aria-label="Page navigation">
                  <ul class="pagination justify-content-center mt-3">
                    <li class="page-item disabled"><a class="page-link" href="#">上一页</a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">下一页</a></li>
                </ul>
                </nav>
                <div class="clone-log-terminal">
                  <div class="clone-log-title">任务信息
                    <button class="clone-log-copy" title="复制内容" onclick="copyTerminalContent(this)"><i class="bi bi-clipboard"></i></button>
                  </div>
                  <div class="clone-log-body">
                    <pre>
[10:05:01] 任务队列初始化完成。
[10:05:03] 检查虚拟机 vm_01 状态 ... 正常
[10:05:04] 检查虚拟机 vm_02 状态 ... 正常
[10:05:05] 检查虚拟机 vm_03 状态 ... 正常
[10:05:06] 检查虚拟机 vm_04 状态 ... 正常
[10:05:07] 检查虚拟机 vm_05 状态 ... 正常
[10:05:08] 检查虚拟机 vm_06 状态 ... 正常
[10:05:10] 所有虚拟机状态正常，准备批量操作。
[10:05:12] 批量重启任务已下发。
[10:05:15] 批量关机任务已下发。
[10:05:18] 批量挂起任务已下发。
...
                    </pre>
                  </div>
                </div>
            </div>
            <div id="panel-wuma" style="display:none;">
                <h3>虚拟机五码管理</h3>
                <div class="mb-3">
                    <button class="btn btn-outline-secondary btn-sm">上传五码文本</button>
                </div>
                <table class="table table-bordered bg-white">
                    <thead>
                        <tr>
                            <th>名称</th>
                            <th>可用数量</th>
                            <th>已用</th>
                            <th>五码版本</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>文本1</td>
                            <td>文本2</td>
                            <td>文本3</td>
                            <td>版本A</td>
                            <td><button class="btn btn-outline-secondary btn-sm">查看五码</button></td>
                        </tr>
                        <tr>
                            <td>文本4</td>
                            <td>文本5</td>
                            <td>文本6</td>
                            <td>版本B</td>
                            <td><button class="btn btn-outline-secondary btn-sm">查看五码</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="panel-wuma-version" style="display:none;">
                <h3>五码版本</h3>
                <p>这里是五码版本的内容（可后续扩展）</p>
            </div>
            <div id="panel-mupan" style="display:none;">
                <h3>虚拟机母盘管理</h3>
                <div class="mb-3 d-flex gap-2">
                    <button class="btn btn-outline-secondary btn-sm">上传母盘</button>
                    <button class="btn btn-outline-secondary btn-sm">初始化母盘</button>
                    <button class="btn btn-outline-secondary btn-sm">删除所有快照</button>
                </div>
                <table class="table table-bordered bg-white">
                    <thead>
                        <tr>
                            <th>母盘名称</th>
                            <th>母盘虚拟机名称</th>
                            <th>母盘版本</th>
                            <th>母盘大小</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>base_disk_01</td><td>vm_01</td><td>macos10.12</td><td>40GB</td><td><button class="btn btn-outline-secondary btn-sm">数据校验</button></td></tr>
                        <tr><td>base_disk_02</td><td>vm_02</td><td>macos10.15</td><td>60GB</td><td><button class="btn btn-outline-secondary btn-sm">数据校验</button></td></tr>
                    </tbody>
                </table>
            </div>
            <div id="panel-script-list" style="display:none;">
                <h3>脚本列表</h3>
                <div class="mb-3 d-flex gap-2">
                    <button class="btn btn-outline-secondary btn-sm">批量上传脚本</button>
                    <button class="btn btn-outline-secondary btn-sm">刷新列表</button>
                </div>
                <table class="table table-bordered bg-white">
                    <thead>
                        <tr>
                            <th>文件名</th>
                            <th>修改时间</th>
                            <th>大小(Byte)</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for script in script_list %}
                        <tr>
                            <td>{{ script.name }}</td>
                            <td>{{ script.mtime }}</td>
                            <td>{{ script.size }}</td>
                            <td><button class="btn btn-outline-secondary btn-sm">脚本修改</button></td>
                            <td><button class="btn btn-outline-secondary btn-sm">上传至mac</button></td>

                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <nav aria-label="Page navigation">
                  <ul class="pagination justify-content-center mt-3">
                    <li class="page-item disabled"><a class="page-link" href="#">上一页</a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">下一页</a></li>
                </ul>
                </nav>
            </div>
            <div id="panel-clone" style="display:none;">
                <h3>虚拟机批量克隆</h3>
                <button class="btn btn-outline-secondary btn-sm mb-3" data-bs-toggle="modal" data-bs-target="#cloneTaskModal">启动克隆任务</button>
                <div class="modal fade" id="cloneTaskModal" tabindex="-1" aria-labelledby="cloneTaskModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content bg-dark text-light">
                      <div class="modal-header">
                        <h5 class="modal-title" id="cloneTaskModalLabel">启动克隆任务</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <form id="cloneTaskForm" action="/api/clone_vm" method="post">
                          <div class="mb-3">
                            <label for="cloneCount" class="form-label">克隆数量</label>
                            <input type="number" class="form-control" id="cloneCount" min="1" max="20" value="1">
                          </div>
                          <div class="mb-3">
                            <label for="cloneName" class="form-label">克隆名称</label>
                            <input type="text" class="form-control mb-2" id="cloneName" placeholder="如 vm_clone_01">
                            <select class="form-select" id="cloneNameSelect">
                              <option value="">选择已有名称</option>
                              <option value="vm_clone_01">vm_clone_01</option>
                              <option value="vm_clone_02">vm_clone_02</option>
                              <option value="vm_clone_03">vm_clone_03</option>
                            </select>
                          </div>
                          <div class="mb-3">
                            <label for="clonePath" class="form-label">物理存放位置</label>
                            <input type="text" class="form-control mb-2" id="clonePath" placeholder="如 D:/macos_vms">
                            <select class="form-select" id="clonePathSelect">
                              <option value="">选择已有路径</option>
                              <option value="D:/macos_vms">D:/macos_vms</option>
                              <option value="E:/macos_vms">E:/macos_vms</option>
                            </select>
                          </div>
                          <div class="mb-3">
                            <label for="cloneBaseDisk" class="form-label">母盘选择</label>
                            <select class="form-select" id="cloneBaseDisk">
                              <option value="">请选择母盘</option>
                              <option value="base_disk_01">base_disk_01</option>
                              <option value="base_disk_02">base_disk_02</option>
                            </select>
                          </div>
                          <div class="mb-3">
                            <label class="form-label">克隆方式</label>
                            <div>
                              <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="cloneType" id="linkClone" value="link" checked>
                                <label class="form-check-label" for="linkClone">链接克隆</label>
                              </div>
                              <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="cloneType" id="fullClone" value="full">
                                <label class="form-check-label" for="fullClone">完整克隆</label>
                              </div>
                            </div>
                          </div>
                          <div class="mb-3">
                            <label class="form-label">自增方式</label>
                            <div>
                              <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="autoIncType" id="autoNum" value="num" checked>
                                <label class="form-check-label" for="autoNum">自增数字</label>
                              </div>
                              <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="autoIncType" id="autoAlpha" value="alpha">
                                <label class="form-check-label" for="autoAlpha">自增字母</label>
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="submit" class="btn btn-primary">确认启动</button>
                      </div>
                    </div>
                  </div>
                </div>
                <table class="table table-bordered bg-white">
                    <thead>
                        <tr>
                            <th>现存虚拟机名称</th>
                            <th>虚拟机IP</th>
                            <th>虚拟机版本</th>
                            <th>虚拟机状态</th>
                            <th>克隆进程</th>
                            <th>脚本状态</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vm_data in vm_data %}
                            <tr>
                                <td>{{ vm_data.vm_name }}</td>
                                <td>{{ vm_data.vm_ip }}</td>
                                <td>{{ vm_data.vm_version }}</td>
                                <td>{{ vm_data.vm_status }}</td>
                                <td>{{ vm_data.cl_status }}</td>
                                <td>{{ vm_data.sh_status }}</td>
                               
                            </tr>
                        {% endfor %}
                        </tbody>
                </table>
                
                <nav aria-label="Page navigation">
                  <ul class="pagination justify-content-center mt-3">
                    <li class="page-item disabled"><a class="page-link" href="#">上一页</a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">下一页</a></li>
                </ul>
                </nav>
                <div class="clone-log-terminal">
                  <div class="clone-log-title">任务信息
                    <button class="clone-log-copy" title="复制内容" onclick="copyTerminalContent(this)"><i class="bi bi-clipboard"></i></button>
                  </div>
                  <div class="clone-log-body">
                    <pre>
[10:01:23] 开始克隆 vm_01 ...
[10:01:25] vm_01 克隆进程进行中 ...
[10:01:30] vm_01 克隆完成，脚本执行成功。
[10:01:31] 开始克隆 vm_02 ...
[10:01:35] vm_02 克隆进程已完成，脚本执行失败。
[10:01:36] 开始克隆 vm_03 ...
[10:01:40] vm_03 克隆进程进行中 ...
[10:01:45] vm_03 克隆完成，脚本执行成功。
[10:01:46] 开始克隆 vm_04 ...
[10:01:50] vm_04 克隆进程进行中 ...
[10:01:55] vm_04 克隆完成，脚本执行成功。
[10:01:56] 开始克隆 vm_05 ...
[10:02:00] vm_05 克隆进程进行中 ...
[10:02:05] vm_05 克隆完成，脚本执行失败。
[10:02:06] 开始克隆 vm_06 ...
[10:02:10] vm_06 克隆进程进行中 ...
[10:02:15] vm_06 克隆完成，脚本执行成功。
[10:02:16] 开始克隆 vm_07 ...
[10:02:20] vm_07 克隆进程进行中 ...
[10:02:25] vm_07 克隆完成，脚本执行成功。
[10:02:26] 开始克隆 vm_08 ...
[10:02:30] vm_08 克隆进程进行中 ...
[10:02:35] vm_08 克隆完成，脚本执行失败。
[10:02:36] 开始克隆 vm_09 ...
[10:02:40] vm_09 克隆进程进行中 ...
[10:02:45] vm_09 克隆完成，脚本执行成功。
[10:02:46] 开始克隆 vm_10 ...
[10:02:50] vm_10 克隆进程进行中 ...
[10:02:55] vm_10 克隆完成，脚本执行成功。
...
                    </pre>
                  </div>
                </div>
            </div>
            <div id="panel-delete" style="display:none;">
                <h3>虚拟机删除</h3>
                <p>这里是虚拟机删除的内容（可后续扩展）</p>
            </div>
            <div id="panel-trust" style="display:none;">
                <h3>虚拟机互信管理</h3>
                <p>这里是虚拟机互信管理的内容（可后续扩展）</p>
            </div>
            <!-- 新增内容面板 -->
            <div id="panel-encrypt" style="display:none;">
                <h3>数据加密功能</h3>
                <p>这里是数据加密功能的内容（可后续扩展）</p>
            </div>
            <div id="panel-encrypt-code" style="display:none;">
                <h3>代码加密</h3>
                <p>这里是代码加密的内容（可后续扩展）</p>
            </div>
            <div id="panel-encrypt-wuma" style="display:none;">
                <h3>五码加密</h3>
                <p>这里是五码加密的内容（可后续扩展）</p>
            </div>
            <div id="panel-encrypt-id" style="display:none;">
                <h3>id加密</h3>
                <p>这里是id加密的内容（可后续扩展）</p>
            </div>
            <div id="panel-soft" style="display:none;">
                <h3>虚拟机软件管理</h3>
                <p>这里是虚拟机软件管理的内容（可后续扩展）</p>
            </div>
            <div id="panel-soft-version" style="display:none;">
                <h3>版本查看</h3>
                <p>这里是版本查看的内容（可后续扩展）</p>
            </div>
            <div id="panel-soft-env" style="display:none;">
                <h3>环境变量</h3>
                <p>这里是环境变量的内容（可后续扩展）</p>
            </div>
            <div id="panel-cpu" style="display:none;">
                <h3>CPU资源</h3>
                <p>这里是CPU资源的内容（可后续扩展）</p>
            </div>
            <div id="panel-mem" style="display:none;">
                <h3>内存资源</h3>
                <p>这里是内存资源的内容（可后续扩展）</p>
            </div>
            <div id="panel-disk" style="display:none;">
                <h3>磁盘资源</h3>
                <p>这里是磁盘资源的内容（可后续扩展）</p>
            </div>
            <div id="panel-sys-version" style="display:none;">
                <h3>系统版本</h3>
                <p>这里是系统版本的内容（可后续扩展）</p>
            </div>
            <div id="panel-sys-plugin" style="display:none;">
                <h3>系统插件管理</h3>
                <p>这里是系统插件管理的内容（可后续扩展）</p>
            </div>
            <div id="panel-sys-user" style="display:none;">
                <h3>用户管理</h3>
                <p>这里是用户管理的内容（可后续扩展）</p>
            </div>
            <div id="panel-sys-auth" style="display:none;">
                <h3>授权管理</h3>
                <p>这里是授权管理的内容（可后续扩展）</p>
            </div>
            <div id="panel-proxy-assign" style="display:none;">
                <h3>代理ip分配</h3>
                <p>这里是代理ip分配的内容（可后续扩展）</p>
            </div>
            <div id="panel-boot" style="display:none;">
                <h3>引导管理</h3>
                <p>这里是引导管理的内容（可后续扩展）</p>
            </div>
        </main>
    </div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.js"></script>
<script>
function showPanel(type) {
    document.getElementById('panel-list').style.display = (type === 'list') ? '' : 'none';
    document.getElementById('panel-wuma').style.display = (type === 'wuma') ? '' : 'none';
    document.getElementById('panel-wuma-version').style.display = (type === 'wuma-version') ? '' : 'none';
    document.getElementById('panel-mupan').style.display = (type === 'mupan') ? '' : 'none';
    document.getElementById('panel-script-list').style.display = (type === 'script-list') ? '' : 'none';
    document.getElementById('panel-clone').style.display = (type === 'clone') ? '' : 'none';
    document.getElementById('panel-delete').style.display = (type === 'delete') ? '' : 'none';
    document.getElementById('panel-trust').style.display = (type === 'trust') ? '' : 'none';
    document.getElementById('panel-encrypt').style.display = (type === 'encrypt') ? '' : 'none';
    document.getElementById('panel-encrypt-code').style.display = (type === 'encrypt-code') ? '' : 'none';
    document.getElementById('panel-encrypt-wuma').style.display = (type === 'encrypt-wuma') ? '' : 'none';
    document.getElementById('panel-encrypt-id').style.display = (type === 'encrypt-id') ? '' : 'none';
    document.getElementById('panel-proxy-assign').style.display = (type === 'proxy-assign') ? '' : 'none';
    document.getElementById('panel-soft').style.display = (type === 'soft') ? '' : 'none';
    document.getElementById('panel-soft-version').style.display = (type === 'soft-version') ? '' : 'none';
    document.getElementById('panel-soft-env').style.display = (type === 'soft-env') ? '' : 'none';
    document.getElementById('panel-cpu').style.display = (type === 'cpu') ? '' : 'none';
    document.getElementById('panel-mem').style.display = (type === 'mem') ? '' : 'none';
    document.getElementById('panel-disk').style.display = (type === 'disk') ? '' : 'none';
    document.getElementById('panel-sys-version').style.display = (type === 'sys-version') ? '' : 'none';
    document.getElementById('panel-sys-plugin').style.display = (type === 'sys-plugin') ? '' : 'none';
    document.getElementById('panel-sys-user').style.display = (type === 'sys-user') ? '' : 'none';
    document.getElementById('panel-sys-auth').style.display = (type === 'sys-auth') ? '' : 'none';
    document.getElementById('panel-boot').style.display = (type === 'boot') ? '' : 'none';
    // 菜单高亮
    var links = document.querySelectorAll('.nav-link');
    links.forEach(link => link.classList.remove('active'));
    // 虚拟机管理子菜单高亮
    if(type === 'clone') {
        var vmLinks = document.querySelectorAll('#accordionMenu .nav-link');
        vmLinks.forEach(link => link.classList.remove('active'));
        vmLinks[0].classList.add('active');
    }
    if(type === 'list') links[0].classList.add('active');
    if(type === 'wuma') links[1].classList.add('active');
    if(type === 'mupan') links[2].classList.add('active');
    // 脚本管理子菜单高亮
    if(type === 'script-list') {
        var scriptLinks = document.querySelectorAll('#collapseScript .nav-link');
        scriptLinks.forEach(link => link.classList.remove('active'));
        scriptLinks[0].classList.add('active');
    }
    // 五码管理子菜单高亮
    if(type === 'wuma' || type === 'wuma-version') {
        var wumaLinks = document.querySelectorAll('#collapseWuma .nav-link');
        wumaLinks.forEach(link => link.classList.remove('active'));
        if(type === 'wuma') wumaLinks[0].classList.add('active');
        if(type === 'wuma-version') wumaLinks[1].classList.add('active');
    }
    // 虚拟机互信管理子菜单高亮
    if(type === 'trust') {
        var vmLinks = document.querySelectorAll('#accordionMenu .nav-link');
        vmLinks.forEach(link => link.classList.remove('active'));
        vmLinks[5].classList.add('active');
    }
    // 数据加密功能子菜单高亮
    if(type === 'encrypt' || type === 'encrypt-code' || type === 'encrypt-wuma' || type === 'encrypt-id') {
        var encryptLinks = document.querySelectorAll('#collapseEncrypt .nav-link');
        encryptLinks.forEach(link => link.classList.remove('active'));
        if(type === 'encrypt') encryptLinks[0].classList.add('active');
        if(type === 'encrypt-code') encryptLinks[0].classList.add('active');
        if(type === 'encrypt-wuma') encryptLinks[1].classList.add('active');
        if(type === 'encrypt-id') encryptLinks[2].classList.add('active');
    }
    // 代理ip配置子菜单高亮
    if(type === 'proxy-assign') {
        var proxyLinks = document.querySelectorAll('#collapseProxy .nav-link');
        proxyLinks.forEach(link => link.classList.remove('active'));
        proxyLinks[0].classList.add('active');
    }
}


document.getElementById('cloneForm').onsubmit = function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  const data = {};
  formData.forEach((v, k) => data[k] = v);

  fetch('/api/clone_vm', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(res => {
    if(res.status === 'ok') {
      document.getElementById('cloneResult').innerHTML = '克隆成功:<br>' + res.cloned.map(x => `<div>${x}</div>`).join('');
    } else {
      document.getElementById('cloneResult').innerHTML = '克隆失败: ' + res.msg;
    }
  })
  .catch(err => {
    document.getElementById('cloneResult').innerHTML = '请求失败: ' + err;
  });
};


function toggleAllVMs(source) {
    var checkboxes = document.querySelectorAll('.vm-checkbox');
    checkboxes.forEach(cb => cb.checked = source.checked);
}

function copyTerminalContent(btn) {
  const pre = btn.closest('.clone-log-terminal').querySelector('pre');
  if (pre) {
    navigator.clipboard.writeText(pre.textContent).then(() => {
      btn.innerHTML = '<i class="bi bi-clipboard-check"></i>';
      setTimeout(() => { btn.innerHTML = '<i class="bi bi-clipboard"></i>'; }, 1200);
    });
  }
}

// 通用函数：确保菜单展开并设置链接激活状态
function ensureMenuExpanded(menuId, linkContainerId) {
  const menuCollapse = document.getElementById(menuId);
  const menuButton = document.getElementById(menuId.replace('collapse', 'heading')).querySelector('.accordion-button');
  
  if (menuCollapse && menuButton) {
    // 移除折叠类，添加展开类
    menuCollapse.classList.remove('collapse');
    menuCollapse.classList.add('show');
    menuButton.setAttribute('aria-expanded', 'true');
    menuButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll(`#${linkContainerId} .nav-link`);
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
}

// 处理克隆链接点击，确保菜单保持展开状态
function handleCloneClick() {
  ensureMenuExpanded('collapseVM', 'collapseVM');
}

// 处理虚拟机成品信息链接点击，确保菜单保持展开状态
function handleVMInfoClick() {
  ensureMenuExpanded('collapseVM', 'collapseVM');
  // 显示虚拟机成品信息面板
  showPanel('list');
}

// 处理虚拟机脚本管理链接点击，确保菜单保持展开状态
function handleVMScriptClick() {
  // 确保虚拟机管理菜单展开
  const vmCollapse = document.getElementById('collapseVM');
  const vmButton = document.getElementById('headingVM').querySelector('.accordion-button');
  
  if (vmCollapse && vmButton) {
    // 移除折叠类，添加展开类
    vmCollapse.classList.remove('collapse');
    vmCollapse.classList.add('show');
    vmButton.setAttribute('aria-expanded', 'true');
    vmButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll('#collapseVM .nav-link');
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
  
  // 显示虚拟机脚本管理面板
  showPanel('script-list');
}

// 处理虚拟机互信管理链接点击，确保菜单保持展开状态
function handleVMTrustClick() {
  // 确保虚拟机管理菜单展开
  const vmCollapse = document.getElementById('collapseVM');
  const vmButton = document.getElementById('headingVM').querySelector('.accordion-button');
  
  if (vmCollapse && vmButton) {
    // 移除折叠类，添加展开类
    vmCollapse.classList.remove('collapse');
    vmCollapse.classList.add('show');
    vmButton.setAttribute('aria-expanded', 'true');
    vmButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll('#collapseVM .nav-link');
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
  
  // 显示虚拟机互信管理面板
  showPanel('trust');
}

// 处理虚拟机五码管理链接点击，确保菜单保持展开状态
function handleWumaClick() {
  // 确保引导管理菜单展开
  const bootCollapse = document.getElementById('collapseBoot');
  const bootButton = document.getElementById('headingBoot').querySelector('.accordion-button');
  
  if (bootCollapse && bootButton) {
    // 移除折叠类，添加展开类
    bootCollapse.classList.remove('collapse');
    bootCollapse.classList.add('show');
    bootButton.setAttribute('aria-expanded', 'true');
    bootButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll('#collapseBoot .nav-link');
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
  
  // 显示虚拟机五码管理面板
  showPanel('wuma');
}

// 处理虚拟机母盘管理链接点击，确保菜单保持展开状态
function handleMupanClick() {
  // 确保引导管理菜单展开
  const bootCollapse = document.getElementById('collapseBoot');
  const bootButton = document.getElementById('headingBoot').querySelector('.accordion-button');
  
  if (bootCollapse && bootButton) {
    // 移除折叠类，添加展开类
    bootCollapse.classList.remove('collapse');
    bootCollapse.classList.add('show');
    bootButton.setAttribute('aria-expanded', 'true');
    bootButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll('#collapseBoot .nav-link');
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
  
  // 显示虚拟机母盘管理面板
  showPanel('mupan');
}

// 处理代码加密链接点击，确保菜单保持展开状态
function handleEncryptCodeClick() {
  // 确保数据加密功能菜单展开
  const encryptCollapse = document.getElementById('collapseEncrypt');
  const encryptButton = document.getElementById('headingEncrypt').querySelector('.accordion-button');
  
  if (encryptCollapse && encryptButton) {
    // 移除折叠类，添加展开类
    encryptCollapse.classList.remove('collapse');
    encryptCollapse.classList.add('show');
    encryptButton.setAttribute('aria-expanded', 'true');
    encryptButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll('#collapseEncrypt .nav-link');
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
  
  // 显示代码加密面板
  showPanel('encrypt-code');
}

// 处理五码加密链接点击，确保菜单保持展开状态
function handleEncryptWumaClick() {
  // 确保数据加密功能菜单展开
  const encryptCollapse = document.getElementById('collapseEncrypt');
  const encryptButton = document.getElementById('headingEncrypt').querySelector('.accordion-button');
  
  if (encryptCollapse && encryptButton) {
    // 移除折叠类，添加展开类
    encryptCollapse.classList.remove('collapse');
    encryptCollapse.classList.add('show');
    encryptButton.setAttribute('aria-expanded', 'true');
    encryptButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll('#collapseEncrypt .nav-link');
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
  
  // 显示五码加密面板
  showPanel('encrypt-wuma');
}

// 处理id加密链接点击，确保菜单保持展开状态
function handleEncryptIdClick() {
  // 确保数据加密功能菜单展开
  const encryptCollapse = document.getElementById('collapseEncrypt');
  const encryptButton = document.getElementById('headingEncrypt').querySelector('.accordion-button');
  
  if (encryptCollapse && encryptButton) {
    // 移除折叠类，添加展开类
    encryptCollapse.classList.remove('collapse');
    encryptCollapse.classList.add('show');
    encryptButton.setAttribute('aria-expanded', 'true');
    encryptButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll('#collapseEncrypt .nav-link');
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
  
  // 显示id加密面板
  showPanel('encrypt-id');
}

// 处理代理ip分配链接点击，确保菜单保持展开状态
function handleProxyAssignClick() {
  // 确保代理ip配置菜单展开
  const proxyCollapse = document.getElementById('collapseProxy');
  const proxyButton = document.getElementById('headingProxy').querySelector('.accordion-button');
  
  if (proxyCollapse && proxyButton) {
    // 移除折叠类，添加展开类
    proxyCollapse.classList.remove('collapse');
    proxyCollapse.classList.add('show');
    proxyButton.setAttribute('aria-expanded', 'true');
    proxyButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll('#collapseProxy .nav-link');
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
  
  // 显示代理ip分配面板
  showPanel('proxy-assign');
}

// 处理版本查看链接点击，确保菜单保持展开状态
function handleSoftVersionClick() {
  // 确保虚拟机软件管理菜单展开
  const softCollapse = document.getElementById('collapseSoft');
  const softButton = document.getElementById('headingSoft').querySelector('.accordion-button');
  
  if (softCollapse && softButton) {
    // 移除折叠类，添加展开类
    softCollapse.classList.remove('collapse');
    softCollapse.classList.add('show');
    softButton.setAttribute('aria-expanded', 'true');
    softButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll('#collapseSoft .nav-link');
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
  
  // 显示版本查看面板
  showPanel('soft-version');
}

// 处理环境变量链接点击，确保菜单保持展开状态
function handleSoftEnvClick() {
  // 确保虚拟机软件管理菜单展开
  const softCollapse = document.getElementById('collapseSoft');
  const softButton = document.getElementById('headingSoft').querySelector('.accordion-button');
  
  if (softCollapse && softButton) {
    // 移除折叠类，添加展开类
    softCollapse.classList.remove('collapse');
    softCollapse.classList.add('show');
    softButton.setAttribute('aria-expanded', 'true');
    softButton.classList.remove('collapsed');
  }
  
  // 设置当前链接为激活状态
  const links = document.querySelectorAll('#collapseSoft .nav-link');
  links.forEach(link => link.classList.remove('active'));
  event.target.classList.add('active');
  
  // 显示环境变量面板
  showPanel('soft-env');
}
</script>
</body>
</html> 