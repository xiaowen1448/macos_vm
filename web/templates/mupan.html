<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VM 虚拟机管理平台 - 母盘管理</title>
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/font-awesome.min.css') }}" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
            .sidebar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 2px 0 15px rgba(102, 126, 234, 0.3);
        min-height: 100vh;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
        width: 280px;
        color: white;
    }
        
        .accordion-button:not(.collapsed) {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            box-shadow: none;
        }
        
        .accordion-button {
            background: transparent;
            color: white;
            border: none;
            box-shadow: none;
            font-weight: 600;
        }
        
        .accordion-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .accordion-button:focus {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            box-shadow: none;
        }
        
        .accordion-button::after {
            filter: invert(1);
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            border-radius: 8px;
            margin: 4px 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            transform: translateX(5px);
        }
        
        .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .accordion-item {
            background: transparent;
            border: none;
        }
        
        .accordion-body {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin: 0 8px;
        }
        
        .card {
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 5px 5px 0 0 !important;
            padding: 1px;
        }
        html, body { width: 100vw; overflow-x: hidden !important; }
        .col-md-9.col-lg-10 { width: calc(100vw - 280px); min-width: 0; margin: 0; height: calc(100vh - 80px); overflow-y: auto; overflow-x: hidden; }
        
        /* 侧边栏标题样式 */
        .sidebar-header {
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: left;
            min-height: 60px;
        }
        
        .brand-text {
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar-header h4 {
            margin-bottom: 5px !important;
        }
        
        .sidebar-header small {
            font-size: 0.85rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <div class="navbar navbar-expand-lg navbar-light bg-white shadow-sm" style="position: fixed; top: 0; left: 280px; right: 0; z-index: 1000;">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-hdd me-2"></i>虚拟机母盘管理
            </span>
            <div class="d-flex">
                <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary me-3">
                    <i class="fas fa-home me-2"></i>主页
                </a>
                <div class="dropdown me-3">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="langDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        语言
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="langDropdown">
                        <li><a class="dropdown-item" href="?lang=zh">中文</a></li>
                        <li><a class="dropdown-item" href="?lang=en">English</a></li>
                    </ul>
                </div>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-secondary">登出</a>
            </div>
        </div>
    </div>
    
    <div class="container-fluid" style="margin-left: 280px; margin-top: 80px;">
        <div class="row">
            <!-- 左侧菜单 -->
            <nav class="col-md-3 col-lg-2 sidebar p-3">
                <div class="sidebar-header text-center mb-4">
                <h4 class="mb-0">
                                                <span class="brand-text">VM 虚拟机管理平台</span>
                </h4>
                
            </div>
                <div class="accordion" id="accordionMenu">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingVM">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseVM" aria-expanded="false" aria-controls="collapseVM">
                                虚拟机管理
                            </button>
                        </h2>
                        <div id="collapseVM" class="accordion-collapse collapse" aria-labelledby="headingVM" data-bs-parent="#accordionMenu">
                            <div class="accordion-body p-0">
                                <ul class="nav flex-column">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('clone_vm_page') }}" onclick="handleCloneClick()">虚拟机批量克隆</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('vm_management_page') }}" onclick="handleVMManagementClick()">虚拟机克隆列表</a>
                                    </li>
                               
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('vm_script_page') }}" onclick="handleVMScriptClick()">虚拟机脚本管理</a>
                                    </li>
                                     <li class="nav-item">
                                 <a class="nav-link active" href="{{ url_for('icloud_manager.vm_icloud') }}">iCloud管理</a>                            
                                     </li>  
                                </ul>
                            </div>
                        </div>
                    </div>
                      <div class="accordion-item">
                <h2 class="accordion-header" id="headingClient">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseClient" aria-expanded="false" aria-controls="collapseClient">
                        客户端管理
                    </button>
                </h2>
                <div id="collapseClient" class="accordion-collapse collapse" aria-labelledby="headingClient" data-bs-parent="#accordionMenu">
                    <div class="accordion-body p-0">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('client_management_page') }}">ScptRunner客户端管理</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('json_parser_page') }}"><i class="fas fa-code me-2"></i>JSON解析功能</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
              <!-- IM管理主菜单 -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingMessaging">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMessaging" aria-expanded="false" aria-controls="collapseMessaging">
                        IM管理
                    </button>
                </h2>
                <div id="collapseMessaging" class="accordion-collapse collapse " aria-labelledby="headingMessaging" data-bs-parent="#accordionMenu">
                    <div class="accordion-body p-0">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link active" href="{{ url_for('phone_management_page') }}"><i class="fas fa-phone me-2"></i>手机号管理</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('mass_messaging.mass_messaging_page') }}"><i class="fas fa-broadcast-tower me-2"></i>群发管理</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingBoot">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBoot" aria-expanded="true" aria-controls="collapseBoot">
                                杂项管理
                            </button>
                        </h2>
                        <div id="collapseBoot" class="accordion-collapse collapse show" aria-labelledby="headingBoot" data-bs-parent="#accordionMenu">
                            <div class="accordion-body p-0">
                                <ul class="nav flex-column">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('wuma_page') }}" onclick="handleWumaClick()">虚拟机五码管理</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link active" href="{{ url_for('mupan_page') }}" onclick="handleMupanClick()">虚拟机母盘管理</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('id_management_page') }}" onclick="handleIdManagementClick()">Apple ID管理</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingEncrypt">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEncrypt" aria-expanded="false" aria-controls="collapseEncrypt">
                                数据加密功能
                            </button>
                        </h2>
                        <div id="collapseEncrypt" class="accordion-collapse collapse" aria-labelledby="headingEncrypt" data-bs-parent="#accordionMenu">
                            <div class="accordion-body p-0">
                                <ul class="nav flex-column">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('encrypt_code_page') }}" onclick="handleEncryptCodeClick()">代码加密</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('encrypt_wuma_page') }}" onclick="handleEncryptWumaClick()">五码加密</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('encrypt_id_page') }}" onclick="handleEncryptIdClick()">id加密</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingProxy">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProxy" aria-expanded="false" aria-controls="collapseProxy">
                                代理ip配置
                            </button>
                        </h2>
                        <div id="collapseProxy" class="accordion-collapse collapse" aria-labelledby="headingProxy" data-bs-parent="#accordionMenu">
                            <div class="accordion-body p-0">
                                <ul class="nav flex-column">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('proxy_assign_page') }}" onclick="handleProxyAssignClick()">代理ip分配</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingSoft">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSoft" aria-expanded="false" aria-controls="collapseSoft">
                                虚拟机软件管理
                            </button>
                        </h2>
                        <div id="collapseSoft" class="accordion-collapse collapse" aria-labelledby="headingSoft" data-bs-parent="#accordionMenu">
                            <div class="accordion-body p-0">
                                <ul class="nav flex-column">
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('soft_version_page') }}" onclick="handleSoftVersionClick()">版本查看</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('soft_env_page') }}" onclick="handleSoftEnvClick()">环境变量</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
            
            <!-- 右侧内容区域 -->
            <div class="col-md-9 col-lg-10">
                <div class="card mt-0" style="margin-top:0;">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4 class="mb-0">
                                <i class="fas fa-hdd me-2"></i>虚拟机母盘管理
                            </h4>
                            <button class="btn btn-primary" onclick="refreshMupanData()">
                                <i class="fas fa-sync-alt me-2"></i>刷新数据
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <h5>母盘管理</h5>
                                <p class="text-muted">管理虚拟机的母盘模板，包括模板创建、更新、删除等操作。</p>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>母盘名称</th>
                                                <th>系统版本</th>
                                                <th>大小</th>
                                                <th>创建时间</th>
                                                <th>状态</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="mupanTableBody">
                                            <!-- 动态加载数据 -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

<!-- 设置互信弹窗 -->
<div class="modal fade" id="setupTrustModal" tabindex="-1" aria-labelledby="setupTrustModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="setupTrustModalLabel">
                    <i class="fas fa-handshake me-2"></i>设置SSH互信
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info" role="alert">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>提示：</strong>此操作将为虚拟机设置SSH互信，确保后续操作可以免密码连接。
                </div>

                <div id="trustMessage" class="alert" style="display: none;">
                    <span id="trustMessageText"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>取消
                </button>
                <button type="button" class="btn btn-primary" id="confirmTrustBtn" onclick="confirmSetupTrust()">
                    <i class="fas fa-handshake me-2"></i>确认设置
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 快照管理弹窗 -->
<div class="modal fade" id="snapshotModal" tabindex="-1" aria-labelledby="snapshotModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="snapshotModalLabel">
                    <i class="fas fa-camera me-2"></i>快照管理 - <span id="currentVmName"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- 消息提示框 -->
                <div id="snapshotMessage" class="alert alert-info" style="display: none;">
                    <i class="fas fa-info-circle me-2"></i>
                    <span id="snapshotMessageText"></span>
                </div>
                
                <!-- 搜索框 -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control" id="snapshotSearchInput" placeholder="搜索快照名称..." onkeyup="searchSnapshots()">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-outline-secondary" onclick="clearSnapshotSearch()">
                            <i class="fas fa-times"></i> 清除搜索
                        </button>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>快照名称</th>
                                <th>创建日期</th>
                                <th>关联虚拟机</th>
                                <th>关联VMDK</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="snapshotTableBody">
                            <!-- 动态加载快照数据 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页控件 -->
                <div class="d-flex justify-content-between align-items-center mt-3" id="snapshotPaginationContainer" style="display: none !important;">
                    <div class="d-flex align-items-center">
                        <div class="text-muted me-3">
                            <i class="fas fa-info-circle me-1"></i>
                            显示 <span id="snapshotStartRecord" class="fw-bold">0</span> - <span id="snapshotEndRecord" class="fw-bold">0</span> 条，共 <span id="snapshotTotalRecords" class="fw-bold">0</span> 条记录
                        </div>
                        <div class="d-flex align-items-center">
                            <label class="form-label mb-0 me-2">每页显示:</label>
                            <select class="form-select form-select-sm" id="snapshotPageSizeSelect" style="width: auto;" onchange="changeSnapshotPageSize()">
                                <option value="5" selected>5</option>
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                        </div>
                    </div>
                    <nav aria-label="快照列表分页">
                        <ul class="pagination pagination-sm mb-0" id="snapshotPagination">
                            <!-- 分页按钮将在这里动态生成 -->
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='lib/bootstrap.bundle.min.js') }}"></script>
    <script>
        // 快照分页相关变量
        let currentSnapshotPage = 1;
        let snapshotPageSize = 5;
        let totalSnapshots = [];
        let filteredSnapshots = [];
        let totalSnapshotPages = 0;
        let currentVmName = '';
        
        // 页面加载时获取母盘数据
        document.addEventListener('DOMContentLoaded', function() {
            refreshMupanData();
        });
        
        // 显示消息提示
        function showMessage(message, type = 'info') {
            const messageDiv = document.getElementById('snapshotMessage');
            const messageText = document.getElementById('snapshotMessageText');
            
            messageDiv.className = `alert alert-${type}`;
            messageText.textContent = message;
            messageDiv.style.display = 'block';
            
            // 3秒后自动隐藏
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        // 刷新母盘数据
        function refreshMupanData() {
            console.log('开始获取母盘数据...');
            
            // 首先获取默认母盘目录
            fetch('/api/default-template-dir')
                .then(response => response.json())
                .then(configData => {
                    if (configData.success) {
                        const templateDir = configData.template_dir;
                        console.log('使用默认母盘目录:', templateDir);
                        
                        // 使用默认目录获取母盘列表
                        return fetch(`/api/mupan_list?template_vm_dir=${encodeURIComponent(templateDir)}`);
                    } else {
                        throw new Error('获取默认母盘目录失败: ' + configData.message);
                    }
                })
                .then(response => {
                    console.log('响应状态:', response.status);
                    console.log('响应头:', response.headers);
                    return response.json();
                })
                .then(data => {
                    console.log('获取到的数据:', data);
                    if (data.success) {
                        console.log('数据获取成功，开始显示...');
                        displayMupanData(data.data);
                    } else {
                        console.error('获取母盘数据失败:', data.message);
                        showMessage('获取母盘数据失败: ' + data.message, 'danger');
                    }
                })
                .catch(error => {
                    console.error('请求失败:', error);
                    showMessage('网络请求失败，请检查网络连接', 'danger');
                });
        }

                // 显示母盘数据
        function displayMupanData(templateVms) {
            console.log('开始显示母盘数据，数据长度:', templateVms.length);
            const tbody = document.getElementById('mupanTableBody');
            console.log('找到表格体元素:', tbody);
            
            tbody.innerHTML = '';

            if (templateVms.length === 0) {
                console.log('没有数据，显示空状态');
                tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">暂无母盘数据</td></tr>';
                return;
            }

            console.log('开始遍历数据...');
            
            // 检查所有虚拟机的SSH互信状态
            Promise.all(templateVms.map(vm => checkSSHTrustStatus(vm.name)))
                .then(trustStatuses => {
                    templateVms.forEach((vm, index) => {
                        console.log(`处理第${index + 1}个虚拟机:`, vm);
                        const row = document.createElement('tr');
                        const trustStatus = trustStatuses[index];
                        
                        // 状态徽章
                        let statusBadge = '';
                        if (vm.status === 'running') {
                            statusBadge = '<span class="badge bg-success">运行中</span>';
                        } else if (vm.status === 'stopped') {
                            statusBadge = '<span class="badge bg-secondary">已停止</span>';
                        } else {
                            statusBadge = '<span class="badge bg-warning">未知</span>';
                        }

                        // SSH互信状态徽章
                        let trustBadge = '';
                        if (trustStatus.trusted) {
                            trustBadge = '<span class="badge bg-success me-2"><i class="fas fa-shield-alt me-1"></i>已互信</span>';
                        } else {
                            trustBadge = '<span class="badge bg-danger me-2"><i class="fas fa-exclamation-triangle me-1"></i>未互信</span>';
                        }

                        // 互信操作按钮
                        let trustButton = '';
                        if (vm.status === 'running') {
                            if (trustStatus.trusted) {
                                trustButton = `<button class="btn btn-sm btn-success me-2" onclick="setupTrust('${vm.name}')" title="重新设置互信">
                                    <i class="fas fa-handshake"></i>
                                </button>`;
                            } else {
                                trustButton = `<button class="btn btn-sm btn-outline-primary me-2" onclick="setupTrust('${vm.name}')" title="添加互信">
                                    <i class="fas fa-handshake"></i>
                                </button>`;
                            }
                        } else {
                            trustButton = `<button class="btn btn-sm btn-outline-secondary me-2" disabled title="虚拟机未运行">
                                <i class="fas fa-handshake"></i>
                            </button>`;
                        }

                        row.innerHTML = `
                            <td>${vm.name}</td>
                            <td>${vm.system_version}</td>
                            <td>${vm.size}</td>
                            <td>${vm.create_time}</td>
                            <td>${statusBadge}</td>
                            <td>
                         
                                <button class="btn btn-sm btn-outline-secondary me-2" onclick="editMupan('${vm.name}')" title="编辑">
                                    <i class="fas fa-edit"></i>
                                </button>
                                ${trustBadge}
                                ${trustButton}
                                <button class="btn btn-sm btn-outline-warning" onclick="cleanInvalidSnapshots('${vm.name}')" title="清理失效快照">
                                    <i class="fas fa-broom"></i>
                                </button>
                            </td>
                        `;
                        
                        tbody.appendChild(row);
                        console.log(`第${index + 1}行已添加到表格`);
                    });
                    
                    console.log('数据显示完成');
                })
                .catch(error => {
                    console.error('检查SSH互信状态失败:', error);
                    // 如果检查失败，使用原有逻辑显示
                    templateVms.forEach((vm, index) => {
                        console.log(`处理第${index + 1}个虚拟机:`, vm);
                        const row = document.createElement('tr');
                        
                        // 状态徽章
                        let statusBadge = '';
                        if (vm.status === 'running') {
                            statusBadge = '<span class="badge bg-success">运行中</span>';
                        } else if (vm.status === 'stopped') {
                            statusBadge = '<span class="badge bg-secondary">已停止</span>';
                        } else {
                            statusBadge = '<span class="badge bg-warning">未知</span>';
                        }

                        row.innerHTML = `
                            <td>${vm.name}</td>
                            <td>${vm.system_version}</td>
                            <td>${vm.size}</td>
                            <td>${vm.create_time}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <span class="badge bg-secondary me-2"><i class="fas fa-question me-1"></i>未知</span>
                                <button class="btn btn-sm btn-outline-secondary me-2" onclick="editMupan('${vm.name}')" title="编辑">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm ${vm.status === 'running' ? 'btn-outline-primary' : 'btn-outline-secondary'} me-2" 
                                        onclick="setupTrust('${vm.name}')" 
                                        ${vm.status !== 'running' ? 'disabled' : ''} 
                                        title="${vm.status === 'running' ? '设置互信' : '虚拟机未运行'}">
                                    <i class="fas fa-handshake"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-warning" onclick="cleanInvalidSnapshots('${vm.name}')" title="清理失效快照">
                                    <i class="fas fa-broom"></i>
                                </button>
                            </td>
                        `;
                        
                        tbody.appendChild(row);
                        console.log(`第${index + 1}行已添加到表格`);
                    });
                    
                    console.log('数据显示完成');
                });
                

        }

        // 编辑母盘
        function editMupan(vmName) {
            currentVmName = vmName;
            currentSnapshotPage = 1;
            
            // 显示快照管理弹窗
            document.getElementById('currentVmName').textContent = vmName;
            loadSnapshots(vmName);
            const modal = new bootstrap.Modal(document.getElementById('snapshotModal'));
            modal.show();
        }

        // 加载快照数据
        function loadSnapshots(vmName) {
            console.log('加载快照数据:', vmName);
            
            // 首先获取默认母盘目录
            fetch('/api/default-template-dir')
                .then(response => response.json())
                .then(configData => {
                    if (configData.success) {
                        const templateDir = configData.template_dir;
                        console.log('使用默认母盘目录:', templateDir);
                        
                        // 使用默认目录加载快照数据
                        return fetch(`/api/snapshots/${encodeURIComponent(vmName)}?template_vm_dir=${encodeURIComponent(templateDir)}`);
                    } else {
                        throw new Error('获取默认母盘目录失败: ' + configData.message);
                    }
                })
                .then(response => response.json())
                .then(data => {
                    console.log('快照数据:', data);
                    if (data.success) {
                        totalSnapshots = data.snapshots || [];
                        filteredSnapshots = [...totalSnapshots];
                        updateSnapshotPagination();
                        displaySnapshotsWithPagination();
                    } else {
                        showMessage('加载快照数据失败: ' + data.message, 'danger');
                        totalSnapshots = [];
                        filteredSnapshots = [];
                        displaySnapshots([]);
                    }
                })
                .catch(error => {
                    console.error('加载快照数据失败:', error);
                    showMessage('网络请求失败，无法加载快照数据', 'danger');
                    displaySnapshots([]);
                });
        }

        // 显示快照数据（带分页）
        function displaySnapshotsWithPagination() {
            const startIndex = (currentSnapshotPage - 1) * snapshotPageSize;
            const endIndex = startIndex + snapshotPageSize;
            const pageSnapshots = filteredSnapshots.slice(startIndex, endIndex);
            
            displaySnapshots(pageSnapshots);
            updateSnapshotRecordInfo();
            
            // 显示或隐藏分页控件
            const paginationContainer = document.getElementById('snapshotPaginationContainer');
            if (filteredSnapshots.length > snapshotPageSize) {
                paginationContainer.style.display = 'flex';
            } else {
                paginationContainer.style.display = 'none';
            }
        }
        
        // 更新快照分页信息
        function updateSnapshotPagination() {
            totalSnapshotPages = Math.ceil(filteredSnapshots.length / snapshotPageSize);
            if (currentSnapshotPage > totalSnapshotPages && totalSnapshotPages > 0) {
                currentSnapshotPage = totalSnapshotPages;
            }
            if (currentSnapshotPage < 1) {
                currentSnapshotPage = 1;
            }
            generateSnapshotPaginationButtons();
        }
        
        // 生成快照分页按钮
        function generateSnapshotPaginationButtons() {
            const pagination = document.getElementById('snapshotPagination');
            pagination.innerHTML = '';
            
            if (totalSnapshotPages <= 1) {
                return;
            }
            
            // 上一页按钮
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentSnapshotPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="goToSnapshotPage(${currentSnapshotPage - 1})">上一页</a>`;
            pagination.appendChild(prevLi);
            
            // 页码按钮
            const startPage = Math.max(1, currentSnapshotPage - 2);
            const endPage = Math.min(totalSnapshotPages, currentSnapshotPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentSnapshotPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="goToSnapshotPage(${i})">${i}</a>`;
                pagination.appendChild(li);
            }
            
            // 下一页按钮
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentSnapshotPage === totalSnapshotPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="goToSnapshotPage(${currentSnapshotPage + 1})">下一页</a>`;
            pagination.appendChild(nextLi);
        }
        
        // 跳转到指定快照页面
        function goToSnapshotPage(page) {
            if (page < 1 || page > totalSnapshotPages || page === currentSnapshotPage) {
                return;
            }
            currentSnapshotPage = page;
            displaySnapshotsWithPagination();
            generateSnapshotPaginationButtons();
        }
        
        // 更改快照每页显示数量
        function changeSnapshotPageSize() {
            const select = document.getElementById('snapshotPageSizeSelect');
            snapshotPageSize = parseInt(select.value);
            currentSnapshotPage = 1;
            updateSnapshotPagination();
            displaySnapshotsWithPagination();
        }
        
        // 更新快照记录信息
         function updateSnapshotRecordInfo() {
             const startRecord = (currentSnapshotPage - 1) * snapshotPageSize + 1;
             const endRecord = Math.min(currentSnapshotPage * snapshotPageSize, filteredSnapshots.length);
             const totalRecords = filteredSnapshots.length;
             
             document.getElementById('snapshotStartRecord').textContent = totalRecords > 0 ? startRecord : 0;
             document.getElementById('snapshotEndRecord').textContent = endRecord;
             document.getElementById('snapshotTotalRecords').textContent = totalRecords;
         }
         
         // 搜索快照
         function searchSnapshots() {
             const searchTerm = document.getElementById('snapshotSearchInput').value.toLowerCase().trim();
             
             if (searchTerm === '') {
                 filteredSnapshots = [...totalSnapshots];
             } else {
                 filteredSnapshots = totalSnapshots.filter(snapshot => 
                     snapshot.name.toLowerCase().includes(searchTerm)
                 );
             }
             
             currentSnapshotPage = 1;
             updateSnapshotPagination();
             displaySnapshotsWithPagination();
         }
         
         // 清除搜索
         function clearSnapshotSearch() {
             document.getElementById('snapshotSearchInput').value = '';
             filteredSnapshots = [...totalSnapshots];
             currentSnapshotPage = 1;
             updateSnapshotPagination();
             displaySnapshotsWithPagination();
         }
        
        // 显示快照数据
        function displaySnapshots(snapshots) {
            const tbody = document.getElementById('snapshotTableBody');
            tbody.innerHTML = '';

            if (snapshots.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">暂无快照数据</td></tr>';
                return;
            }

            snapshots.forEach(snapshot => {
                const row = document.createElement('tr');
                
                // 状态徽章
                let statusBadge = '';
                if (snapshot.can_delete) {
                    statusBadge = '<span class="badge bg-success">可删除</span>';
                } else {
                    statusBadge = '<span class="badge bg-warning">使用中</span>';
                }

                // 关联虚拟机列表
                const relatedVms = snapshot.related_vms && snapshot.related_vms.length > 0 
                    ? snapshot.related_vms.join(', ') 
                    : '无';

                // 关联VMDK文件
                const relatedVmdk = snapshot.disk_file || '无';
                
                // 显示vmdk关联的虚拟机（如果有的话）
                const vmdkAssociatedVms = snapshot.vmdk_associated_vms && snapshot.vmdk_associated_vms.length > 0
                    ? `<br><small class="text-muted">${snapshot.vmdk_associated_vms.join(', ')}</small>`
                    : '';

                row.innerHTML = `
                    <td>${snapshot.name}</td>
                    <td>${snapshot.create_time}</td>
                    <td>${relatedVms}${vmdkAssociatedVms}</td>
                    <td>
                        <span class="badge bg-info">${relatedVmdk}</span>
                        ${snapshot.vmdk_associated_vms && snapshot.vmdk_associated_vms.length > 0 ? 
                            `<br><small class="text-success">已关联 ${snapshot.vmdk_associated_vms.length} 个VM</small>` : 
                            '<br><small class="text-muted">无关联</small>'
                        }
                    </td>
                    <td>${statusBadge}</td>
                    <td>
                        ${snapshot.can_delete ? 
                            `<button class="btn btn-sm btn-outline-danger" onclick="deleteSnapshot('${snapshot.name}')" title="删除快照">
                                <i class="fas fa-trash"></i> 删除
                            </button>` : 
                            `<button class="btn btn-sm btn-secondary" disabled title="快照正在使用中，无法删除">
                                <i class="fas fa-ban"></i> 无法删除
                            </button>`
                        }
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // 删除快照
        function deleteSnapshot(snapshotName) {
            // 设置模态框中的快照名称
            document.getElementById('deleteSnapshotName').textContent = snapshotName;
            document.getElementById('deleteSnapshotNameHidden').value = snapshotName;
            
            // 显示删除确认模态框
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteSnapshotModal'));
            deleteModal.show();
        }
        
        // 确认删除快照
        function confirmDeleteSnapshot() {
            const snapshotName = document.getElementById('deleteSnapshotNameHidden').value;
            const confirmBtn = document.getElementById('confirmDeleteSnapshotBtn');
            const originalText = confirmBtn.innerHTML;
            
            // 显示加载状态
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>删除中...';
            confirmBtn.disabled = true;
            
            // 显示确认消息
            showMessage(`正在删除快照 "${snapshotName}"，请稍候...`, 'warning');
            
            // 首先获取默认母盘目录
            fetch('/api/default-template-dir')
                .then(response => response.json())
                .then(configData => {
                    if (configData.success) {
                        const templateDir = configData.template_dir;
                        console.log('使用默认母盘目录:', templateDir);
                        
                        // 使用默认目录删除快照
                        return fetch('/api/delete-snapshot', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                template_name: currentVmName,
                                snapshot_name: snapshotName,
                                template_vm_dir: templateDir
                            })
                        });
                    } else {
                        throw new Error('获取默认母盘目录失败: ' + configData.message);
                    }
                })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('快照删除成功！', 'success');
                    
                    // 关闭模态框
                    const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteSnapshotModal'));
                    deleteModal.hide();
                    
                    // 重新加载快照列表
                    loadSnapshots(currentVmName);
                } else {
                    showToast('删除失败: ' + (data.message || '未知错误'), 'danger');
                }
            })
            .catch(error => {
                console.error('删除快照失败:', error);
                showToast('删除失败: ' + error.message, 'danger');
            })
            .finally(() => {
                // 重置按钮状态
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            });
        }

         // 清理失效快照
         function cleanInvalidSnapshots(vmName) {
             // 设置当前虚拟机名称
             window.currentCleanVmName = vmName;
             
             // 显示清理确认模态框
             const cleanModal = new bootstrap.Modal(document.getElementById('cleanInvalidSnapshotsModal'));
             cleanModal.show();
         }
         
         // 确认清理失效快照
         function confirmCleanInvalidSnapshots() {
             const vmName = window.currentCleanVmName;
             const confirmBtn = document.getElementById('confirmCleanSnapshotsBtn');
             const originalText = confirmBtn.innerHTML;
             
             // 显示加载状态
             confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>清理中...';
             confirmBtn.disabled = true;
             
             // 显示开始清理的消息
            showToast(`正在清理虚拟机 "${vmName}" 的失效快照，请稍候...`, 'warning');

            // 首先获取默认母盘目录
            fetch('/api/default-template-dir')
                .then(response => response.json())
                .then(configData => {
                    if (configData.success) {
                        const templateDir = configData.template_dir;
                        console.log('使用默认母盘目录:', templateDir);
                        
                        // 使用默认目录清理失效快照
                        return fetch(`/api/clean-invalid-snapshots/${encodeURIComponent(vmName)}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                template_vm_dir: templateDir
                            })
                        });
                    } else {
                        throw new Error('获取默认母盘目录失败: ' + configData.message);
                    }
                })
             .then(response => response.json())
             .then(data => {
                 if (data.success) {
                     showToast(`清理完成！删除的快照数量: ${data.deleted_count}，保留的快照数量: ${data.kept_count}`, 'success');
                     
                     // 关闭模态框
                     const cleanModal = bootstrap.Modal.getInstance(document.getElementById('cleanInvalidSnapshotsModal'));
                     cleanModal.hide();
                     
                     // 刷新母盘数据
                     refreshMupanData();
                 } else {
                     showToast('清理失败: ' + (data.error || '未知错误'), 'danger');
                 }
             })
             .catch(error => {
                 console.error('清理失效快照失败:', error);
                 showToast('清理失败: ' + error.message, 'danger');
             })
             .finally(() => {
                 // 重置按钮状态
                 confirmBtn.innerHTML = originalText;
                 confirmBtn.disabled = false;
             });
         }

        // Toast提示函数
        function showToast(message, type = 'info') {
            // 创建toast容器（如果不存在）
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 9999;
                    max-width: 400px;
                `;
                document.body.appendChild(toastContainer);
            }
            
            // 创建toast元素
            const toast = document.createElement('div');
            const toastId = 'toast-' + Date.now();
            toast.id = toastId;
            
            // 根据类型设置样式
            let bgClass, iconClass;
            switch(type) {
                case 'success':
                    bgClass = 'bg-success';
                    iconClass = 'fas fa-check-circle';
                    break;
                case 'danger':
                case 'error':
                    bgClass = 'bg-danger';
                    iconClass = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    bgClass = 'bg-warning';
                    iconClass = 'fas fa-exclamation-triangle';
                    break;
                default:
                    bgClass = 'bg-info';
                    iconClass = 'fas fa-info-circle';
            }
            
            toast.className = `toast show ${bgClass} text-white mb-2`;
            toast.style.cssText = `
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideInRight 0.3s ease-out;
            `;
            
            toast.innerHTML = `
                <div class="toast-body d-flex align-items-center">
                    <i class="${iconClass} me-2"></i>
                    <span class="flex-grow-1">${message}</span>
                    <button type="button" class="btn-close btn-close-white ms-2" onclick="removeToast('${toastId}')"></button>
                </div>
            `;
            
            // 添加CSS动画
            if (!document.getElementById('toast-animations')) {
                const style = document.createElement('style');
                style.id = 'toast-animations';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // 添加到容器
            toastContainer.appendChild(toast);
            
            // 自动移除
            setTimeout(() => {
                removeToast(toastId);
            }, 4000);
        }
        
        // 移除toast
        function removeToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }
        }

        // 菜单处理函数
        function handleCloneClick() {
            // 只设置当前链接为激活状态，不进行任何菜单操作
            const links = document.querySelectorAll('#collapseVM .nav-link');
            links.forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
        }

        function handleVMManagementClick() {
            // 只设置当前链接为激活状态，不进行任何菜单操作
            const links = document.querySelectorAll('#collapseVM .nav-link');
            links.forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
        }

        function handleVMInfoClick() {
            // 只设置当前链接为激活状态，允许Bootstrap默认行为关闭菜单
            const links = document.querySelectorAll('#collapseVM .nav-link');
            links.forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
            
            // 不阻止默认行为，允许菜单正常关闭
        }

        function handleVMScriptClick() {
            // 只设置当前链接为激活状态，允许Bootstrap默认行为关闭菜单
            const links = document.querySelectorAll('#collapseVM .nav-link');
            links.forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
            
            // 不阻止默认行为，允许菜单正常关闭
        }

        function handleWumaClick() {
            // 不展开任何菜单，只设置当前链接为激活状态
            const links = document.querySelectorAll('#collapseBoot .nav-link');
            links.forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
        }

        function handleMupanClick() {
            // 不展开任何菜单，只设置当前链接为激活状态
            const links = document.querySelectorAll('#collapseBoot .nav-link');
            links.forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
        }

        function handleEncryptCodeClick() {
            ensureMenuExpanded('collapseEncrypt', 'collapseEncrypt');
        }

        function handleEncryptWumaClick() {
            ensureMenuExpanded('collapseEncrypt', 'collapseEncrypt');
        }

        function handleEncryptIdClick() {
            ensureMenuExpanded('collapseEncrypt', 'collapseEncrypt');
        }

        function handleProxyAssignClick() {
            ensureMenuExpanded('collapseProxy', 'collapseProxy');
        }

        function handleSoftVersionClick() {
            ensureMenuExpanded('collapseSoft', 'collapseSoft');
        }

        function handleSoftEnvClick() {
            ensureMenuExpanded('collapseSoft', 'collapseSoft');
        }

        // 通用函数：确保菜单展开并设置链接激活状态
        function ensureMenuExpanded(menuId, linkContainerId) {
            const menuCollapse = document.getElementById(menuId);
            const menuButton = document.getElementById(menuId.replace('collapse', 'heading')).querySelector('.accordion-button');
            
            if (menuCollapse && menuButton) {
                // 移除折叠类，添加展开类
                menuCollapse.classList.remove('collapse');
                menuCollapse.classList.add('show');
                menuButton.setAttribute('aria-expanded', 'true');
                menuButton.classList.remove('collapsed');
            }
            
            // 设置当前链接为激活状态
            const links = document.querySelectorAll(`#${linkContainerId} .nav-link`);
            links.forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
        }

        
        // 检查SSH互信状态
        function checkSSHTrustStatus(vmName) {
            return fetch('/api/check-ssh-trust', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    vm_name: vmName,
                    use_template_dir: true  // 使用template_dir目录
                })
            })
            .then(response => response.json())
            .then(data => {
                return {
                    trusted: data.success && data.trusted,
                    message: data.message || ''
                };
            })
            .catch(error => {
                console.error('检查SSH互信状态失败:', error);
                return {
                    trusted: false,
                    message: '检查失败'
                };
            });
        }

        function setupTrust(vmName, vmIp, vmStatus) {
            // 保存虚拟机名称
            currentVmName = vmName;
            
            // 显示弹窗
            const modal = new bootstrap.Modal(document.getElementById('setupTrustModal'));
            modal.show();
        }

        function confirmSetupTrust() {
            const vmName = currentVmName;
            const confirmBtn = document.getElementById('confirmTrustBtn');
            const originalText = confirmBtn.innerHTML;
            
            // 设置按钮为加载状态
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>设置中...';
            confirmBtn.disabled = true;
            
            // 调用后端API，使用template_dir目录
            fetch('/api/setup-trust', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    vm_name: vmName,
                    use_template_dir: true  // 使用template_dir目录
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showTrustMessage('SSH互信设置成功！', 'success');
                    // 关闭弹窗
                    const modal = bootstrap.Modal.getInstance(document.getElementById('setupTrustModal'));
                    modal.hide();
                    
                    // 刷新母盘列表以更新互信状态显示
                    setTimeout(() => {
                        loadMupanData();
                    }, 1000);
                } else {
                    showTrustMessage('设置失败: ' + (data.error || '未知错误'), 'danger');
                }
            })
            .catch(error => {
                console.error('设置SSH互信失败:', error);
                showTrustMessage('设置失败: ' + error.message, 'danger');
            })
            .finally(() => {
                // 重置按钮状态
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            });
        }

        function showTrustMessage(message, type) {
            showToast(message, type);
        }
    </script>

    <!-- 删除快照确认模态框 -->
    <div class="modal fade" id="deleteSnapshotModal" tabindex="-1" aria-labelledby="deleteSnapshotModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteSnapshotModalLabel">
                        <i class="fas fa-exclamation-triangle me-2"></i>确认删除快照
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-warning me-2"></i>
                        <strong>警告：</strong>此操作不可恢复！
                    </div>
                    <p class="mb-0">您确定要删除快照 "<span id="deleteSnapshotName"></span>" 吗？</p>
                    <input type="hidden" id="deleteSnapshotNameHidden" value="">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>取消
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteSnapshotBtn" onclick="confirmDeleteSnapshot()">
                        <i class="fas fa-trash me-2"></i>确认删除
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 清理失效快照确认模态框 -->
    <div class="modal fade" id="cleanInvalidSnapshotsModal" tabindex="-1" aria-labelledby="cleanInvalidSnapshotsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title" id="cleanInvalidSnapshotsModalLabel">
                        <i class="fas fa-broom me-2"></i>确认清理失效快照
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" role="alert">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>提示：</strong>将删除所有关联虚拟机目录不存在的快照。
                    </div>
                    <p class="mb-0">您确定要清理所有失效快照吗？</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>取消
                    </button>
                    <button type="button" class="btn btn-warning" id="confirmCleanSnapshotsBtn" onclick="confirmCleanInvalidSnapshots()">
                        <i class="fas fa-broom me-2"></i>确认清理
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>